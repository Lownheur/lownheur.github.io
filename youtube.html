<html>
<head></head>
<body>
  <script>
    var YOUR_CLIENT_ID = '91235972960-bjuq63mbtmdemk4qsa4epb4o6c5vo1it.apps.googleusercontent.com';
    var YOUR_REDIRECT_URI = 'https://lownheur.com';
    var AUTHORIZATION_ENDPOINT = 'https://accounts.google.com/o/oauth2/auth';
    var TOKEN_ENDPOINT = 'https://oauth2.googleapis.com/token';

    // Fonction pour vérifier si l'utilisateur est connecté
    function checkIfUserIsLoggedIn() {
      var accessToken = localStorage.getItem('oauth2-test-access-token');
      if (accessToken) {
        getUserInfo(accessToken);
      } else {
        oauth2SignIn();
      }
    }

    // Fonction pour échanger le code d'autorisation contre un jeton d'accès
    function exchangeCodeForToken(code) {
      var xhr = new XMLHttpRequest();
      xhr.open('POST', TOKEN_ENDPOINT);
      xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');

      var tokenParams = {
        'code': code,
        'client_id': YOUR_CLIENT_ID,
        'client_secret': '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', // Remplacez par votre client secret
        'redirect_uri': YOUR_REDIRECT_URI,
        'grant_type': 'authorization_code'
      };

      var formData = [];
      for (var key in tokenParams) {
        formData.push(encodeURIComponent(key) + '=' + encodeURIComponent(tokenParams[key]));
      }

      xhr.onreadystatechange = function (e) {
        if (xhr.readyState === 4) {
          if (xhr.status === 200) {
            var response = JSON.parse(xhr.response);
            var accessToken = response.access_token;
            localStorage.setItem('oauth2-test-access-token', accessToken);
            getUserInfo(accessToken);
          } else {
            console.error('Échec de l\'échange de jeton');
          }
        }
      };

      xhr.send(formData.join('&'));
    }

    // Fonction pour obtenir les informations de l'utilisateur
    function getUserInfo(accessToken) {
      var xhr = new XMLHttpRequest();
      xhr.open('GET', 'https://www.googleapis.com/youtube/v3/channels?part=snippet&mine=true&access_token=' + accessToken);
      xhr.onreadystatechange = function (e) {
        if (xhr.readyState === 4 && xhr.status === 200) {
          var response = JSON.parse(xhr.response);
          var channelName = response.items[0].snippet.title;
          document.getElementById('channelName').innerText = 'Channel Name: ' + channelName;
        } else if (xhr.readyState === 4 && xhr.status === 401) {
          // Jeton non valide, gérer en conséquence
          console.error('Jeton non valide');
        }
      };
      xhr.send(null);
    }

    // Fonction pour gérer la déconnexion
    function logout() {
      localStorage.removeItem('oauth2-test-access-token');
      location.reload(); // Recharger la page pour retourner à l'état non connecté
    }

    var fragmentString = location.hash.substring(1);

    // Analyser la chaîne de requête pour voir si la demande de page provient du serveur OAuth 2.0.
    var params = {};
    var regex = /([^&=]+)=([^&]*)/g, m;
    while (m = regex.exec(fragmentString)) {
      params[decodeURIComponent(m[1])] = decodeURIComponent(m[2]);
    }

    if (params['code']) {
      exchangeCodeForToken(params['code']);
    } else {
      checkIfUserIsLoggedIn();
    }
  </script>

  <!-- Ajouter une balise span pour afficher le nom de la chaîne -->
  <span id="channelName"></span>

  <!-- Ajouter un bouton pour se déconnecter -->
  <button onclick="logout();">Logout</button>

</body>
</html>
