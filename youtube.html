<html>
<head></head>
<body>
  <script>
    var YOUR_CLIENT_ID = '91235972960-bjuq63mbtmdemk4qsa4epb4o6c5vo1it.apps.googleusercontent.com';
    var YOUR_REDIRECT_URI = 'https://lownheur.com';
    var AUTHORIZATION_ENDPOINT = 'https://accounts.google.com/o/oauth2/auth';
    var TOKEN_ENDPOINT = 'https://oauth2.googleapis.com/token';

    var fragmentString = location.hash.substring(1);

    // Parse query string to see if page request is coming from OAuth 2.0 server.
    var params = {};
    var regex = /([^&=]+)=([^&]*)/g, m;
    while (m = regex.exec(fragmentString)) {
      params[decodeURIComponent(m[1])] = decodeURIComponent(m[2]);
    }

    if (Object.keys(params).length > 0) {
      localStorage.setItem('oauth2-test-params', JSON.stringify(params));
      if (params['state'] && params['state'] == 'try_sample_request') {
        exchangeCodeForToken(params['code']);
      }
    } else {
      oauth2SignIn();
    }

    function exchangeCodeForToken(code) {
      var xhr = new XMLHttpRequest();
      xhr.open('POST', TOKEN_ENDPOINT);
      xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');

      var tokenParams = {
        'code': code,
        'client_id': YOUR_CLIENT_ID,
        'client_secret': 'YOUR_CLIENT_SECRET', // Replace with your client secret
        'redirect_uri': YOUR_REDIRECT_URI,
        'grant_type': 'authorization_code'
      };

      var formData = [];
      for (var key in tokenParams) {
        formData.push(encodeURIComponent(key) + '=' + encodeURIComponent(tokenParams[key]));
      }

      xhr.onreadystatechange = function (e) {
        if (xhr.readyState === 4) {
          if (xhr.status === 200) {
            var response = JSON.parse(xhr.response);
            var accessToken = response.access_token;
            getUserInfo(accessToken);
          } else {
            console.error('Token exchange failed');
          }
        }
      };

      xhr.send(formData.join('&'));
    }

    function getUserInfo(accessToken) {
      var xhr = new XMLHttpRequest();
      xhr.open('GET', 'https://www.googleapis.com/youtube/v3/channels?part=snippet&mine=true&access_token=' + accessToken);
      xhr.onreadystatechange = function (e) {
        if (xhr.readyState === 4 && xhr.status === 200) {
          var response = JSON.parse(xhr.response);
          var channelName = response.items[0].snippet.title;
          document.getElementById('channelName').innerText = 'Channel Name: ' + channelName;
        } else if (xhr.readyState === 4 && xhr.status === 401) {
          // Token invalid, handle accordingly
          console.error('Token invalid');
        }
      };
      xhr.send(null);
    }

    function oauth2SignIn() {
      var authorizationUrl =
        AUTHORIZATION_ENDPOINT +
        '?client_id=' + encodeURIComponent(YOUR_CLIENT_ID) +
        '&redirect_uri=' + encodeURIComponent(YOUR_REDIRECT_URI) +
        '&scope=' + encodeURIComponent('https://www.googleapis.com/auth/youtube.force-ssl') +
        '&state=' + encodeURIComponent('try_sample_request') +
        '&response_type=code';

      window.location.href = authorizationUrl;
    }
  </script>

  <span id="channelName"></span>

</body>
</html>
