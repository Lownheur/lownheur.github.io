<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>YouTube Channel Info</title>
  <!-- Add your head content here -->
</head>
<body>

  <!-- Add your HTML content here -->

  <script>
    var YOUR_CLIENT_ID = '91235972960-bjuq63mbtmdemk4qsa4epb4o6c5vo1it.apps.googleusercontent.com';
    var YOUR_REDIRECT_URI = 'https://lownheur.com';
    var AUTHORIZATION_ENDPOINT = 'https://accounts.google.com/o/oauth2/auth';
    var TOKEN_ENDPOINT = 'https://oauth2.googleapis.com/token';

    // Function to check if the user is logged in
    function checkIfUserIsLoggedIn() {
      var accessToken = getCookie('oauth2-test-access-token');
      if (accessToken) {
        getUserInfo(accessToken);
      } else {
        // Check if authorization code is present in the URL
        var urlParams = new URLSearchParams(window.location.search);
        var authorizationCode = urlParams.get('code');
        if (authorizationCode) {
          exchangeCodeForToken(authorizationCode);
        } else {
          oauth2SignIn();
        }
      }
    }

    // Function to exchange the authorization code for an access token
    function exchangeCodeForToken(code) {
      var xhr = new XMLHttpRequest();
      xhr.open('POST', TOKEN_ENDPOINT);
      xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');

      var tokenParams = {
        'code': code,
        'client_id': YOUR_CLIENT_ID,
        'client_secret': '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', // Replace with your client secret
        'redirect_uri': YOUR_REDIRECT_URI,
        'grant_type': 'authorization_code'
      };

      var formData = [];
      for (var key in tokenParams) {
        formData.push(encodeURIComponent(key) + '=' + encodeURIComponent(tokenParams[key]));
      }

      xhr.onreadystatechange = function (e) {
        if (xhr.readyState === 4) {
          if (xhr.status === 200) {
            var response = JSON.parse(xhr.response);
            var accessToken = response.access_token;

            // Use a secure cookie to store the access token
            setCookie('oauth2-test-access-token', accessToken, 1); // 1 day expiration
            getUserInfo(accessToken);
          } else {
            console.error('Token exchange failed');
          }
        }
      };

      xhr.send(formData.join('&'));
    }

    // Function to get user information
    function getUserInfo(accessToken) {
      var xhr = new XMLHttpRequest();
      xhr.open('GET', 'https://www.googleapis.com/youtube/v3/channels?part=snippet&mine=true&access_token=' + accessToken);
      xhr.onreadystatechange = function (e) {
        if (xhr.readyState === 4 && xhr.status === 200) {
          var response = JSON.parse(xhr.response);
          var channelName = response.items[0].snippet.title;
          document.getElementById('channelName').innerText = 'Channel Name: ' + channelName;
          document.getElementById('logoutButton').style.display = 'block';
        } else if (xhr.readyState === 4 && xhr.status === 401) {
          console.error('Invalid token');
          setCookie('oauth2-test-access-token', '', 0); // Remove the cookie
          oauth2SignIn(); // Redirect to the authorization process
        }
      };
      xhr.send(null);
    }

    // Function to handle logout
    function logout() {
      setCookie('oauth2-test-access-token', '', 0); // Remove the cookie
      location.reload(); // Reload the page to go back to the logged-out state
    }

    // Function to start the authorization process
    function oauth2SignIn() {
      var authorizationUrl =
        AUTHORIZATION_ENDPOINT +
        '?client_id=' + encodeURIComponent(YOUR_CLIENT_ID) +
        '&redirect_uri=' + encodeURIComponent(YOUR_REDIRECT_URI) +
        '&scope=' + encodeURIComponent('https://www.googleapis.com/auth/youtube.force-ssl') +
        '&state=' + encodeURIComponent('try_sample_request') +
        '&response_type=code';

      // Redirect the user to the authorization URL
      window.location.href = authorizationUrl;
    }

    // Function to set the value of a cookie
    function setCookie(name, value, days) {
      var expires = '';
      if (days) {
        var date = new Date();
        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
        expires = '; expires=' + date.toUTCString();
      }
      document.cookie = name + '=' + value + expires + '; path=/; secure; samesite=strict';
    }

    // Function to get the value of a cookie
    function getCookie(name) {
      var match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
      if (match) return match[2];
      else return null;
    }

    // Check login status when the page loads
    checkIfUserIsLoggedIn();
  </script>

  <!-- Add a span element to display the channel name -->
  <span id="channelName"></span>

  <!-- Add a button for logout -->
  <button id="logoutButton" onclick="logout();" style="display: none;">Logout</button>

  <!-- Add other HTML content as needed -->

</body>
</html>
