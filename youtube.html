<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OAuth 2.0 Example</title>
</head>
<body>
  <nav class="parent_nav">
    <a href="index.html" class="child_nav">Accueil</a> 
    <a href="linktree.html" class="child_nav">Linktree</a>
    <a href="youtubee.html" class="child_nav" onclick="checkAuthorizationStatus()">youtube api</a>
  </nav>

  <script>
    var YOUR_CLIENT_ID = '91235972960-bjuq63mbtmdemk4qsa4epb4o6c5vo1it.apps.googleusercontent.com';
    var YOUR_REDIRECT_URI = 'https://lownheur.com';
    var oauth2Endpoint = 'https://accounts.google.com/o/oauth2/v2/auth';
    var logoutEndpoint = 'https://accounts.google.com/logout';

    function generateRandomState() {
      return Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
    }

    function storeParamsInCookie(params) {
      var expirationDate = new Date();
      expirationDate.setFullYear(expirationDate.getFullYear() + 10);
      document.cookie = 'oauth2-test-params=' + encodeURIComponent(JSON.stringify(params)) + '; expires=' + expirationDate.toUTCString() + '; path=/';
    }

    function getStoredParams() {
      var cookieValue = document.cookie.replace(/(?:(?:^|.*;\s*)oauth2-test-params\s*=\s*([^;]*).*$)|^.*$/, '$1');
      return cookieValue ? JSON.parse(decodeURIComponent(cookieValue)) : null;
    }

    function clearStoredParams() {
      document.cookie = 'oauth2-test-params=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
    }

    function checkAuthorizationStatus() {
      var storedParams = getStoredParams();

      if (storedParams && storedParams['access_token']) {
        console.log('Access token found:', storedParams['access_token']);
        showUserInfo(storedParams['access_token']);
        showLogoutButton();
      } else {
        showLoginButton();
      }
    }

    function showUserInfo(accessToken) {
      console.log("User is logged in. Access Token: " + accessToken);
    }

    function showLoginButton() {
      var loginButton = document.createElement('button');
      loginButton.textContent = 'Login with Google';
      loginButton.onclick = function () {
        oauth2SignIn();
      };
      document.body.appendChild(loginButton);
    }

    function showLogoutButton() {
      var logoutButton = document.createElement('button');
      logoutButton.textContent = 'Logout';
      logoutButton.onclick = function () {
        logout();
      };
      document.body.appendChild(logoutButton);
    }

    function oauth2SignIn() {
      var state = generateRandomState();

      var params = {
        'client_id': YOUR_CLIENT_ID,
        'redirect_uri': YOUR_REDIRECT_URI,
        'scope': 'https://www.googleapis.com/auth/youtube.force-ssl',
        'state': state,
        'include_granted_scopes': 'true',
        'response_type': 'token'
      };

      storeParamsInCookie(params);

      var form = document.createElement('form');
      form.setAttribute('method', 'GET');
      form.setAttribute('action', oauth2Endpoint);

      for (var p in params) {
        var input = document.createElement('input');
        input.setAttribute('type', 'hidden');
        input.setAttribute('name', p);
        input.setAttribute('value', params[p]);
        form.appendChild(input);
      }

      document.body.appendChild(form);
      form.submit();
    }

    function logout() {
      clearStoredParams();
      window.location.href = logoutEndpoint;
    }

    checkAuthorizationStatus();
  </script>
</body>
</html>
